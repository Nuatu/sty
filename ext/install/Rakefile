require 'rubygems'
require 'fileutils'
require 'sudo'

task default: ['install_script']

task :install_script do

  fail "Sty doesnt work on Windows" if Gem.win_platform?

  src = "#{Dir.pwd}/../../bin/sty"
  dst = '/usr/local/bin/sty'

  #TODO check if /usr/local/bin exists

  begin
    FileUtils.cp(src, dst)
  rescue Errno::EPERM => e
    puts "No permission to create #{dst}, let's try with sudo."
    Sudo::Wrapper.run do |sudo|
      sudo[FileUtils].cp(src, dst)
    end
  end

  home = File.expand_path('~')
  sty_home = "#{home}/.sty/"
  FileUtils.mkdir_p(sty_home)

  yamls = Dir.glob("#{Dir.pwd}/../../*.yaml")
  FileUtils.cp(yamls, sty_home, verbose: true)

end